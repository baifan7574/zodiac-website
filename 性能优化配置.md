# ğŸš€ æ€§èƒ½ä¼˜åŒ–é…ç½®æŒ‡å—

## 1. ä»£ç å‹ç¼©

### HTMLå‹ç¼©
- ä½¿ç”¨å·¥å…·ï¼šHTMLMinifier
- å‘½ä»¤ï¼š`npx html-minifier --input-dir . --output-dir dist --file-ext html --collapse-whitespace --remove-comments`

### CSSå‹ç¼©
- ä½¿ç”¨å·¥å…·ï¼šcssnano æˆ– clean-css
- å‘½ä»¤ï¼š`npx clean-css -o css/style.min.css css/style.css`

### JavaScriptå‹ç¼©
- ä½¿ç”¨å·¥å…·ï¼šTerser æˆ– UglifyJS
- å‘½ä»¤ï¼š`npx terser js/main.js -o js/main.min.js -c -m`

### å‹ç¼©é…ç½®è„šæœ¬
åˆ›å»º `package.json` å’Œå‹ç¼©è„šæœ¬ï¼š

```json
{
  "name": "zodiac-website",
  "version": "1.0.0",
  "scripts": {
    "minify:html": "html-minifier --input-dir . --output-dir dist --file-ext html --collapse-whitespace --remove-comments",
    "minify:css": "clean-css -o dist/css/style.min.css css/style.css",
    "minify:js": "terser js/main.js -o dist/js/main.min.js -c -m --comments false",
    "build": "npm run minify:html && npm run minify:css && npm run minify:js"
  },
  "devDependencies": {
    "html-minifier": "^4.0.0",
    "clean-css-cli": "^5.6.2",
    "terser": "^5.19.2"
  }
}
```

---

## 2. å›¾ç‰‡ä¼˜åŒ–

### ä¼˜åŒ–ç­–ç•¥
1. **ä½¿ç”¨WebPæ ¼å¼**ï¼ˆç°ä»£æµè§ˆå™¨æ”¯æŒï¼‰
2. **å›¾ç‰‡æ‡’åŠ è½½**ï¼ˆå·²å®ç°ï¼‰
3. **å“åº”å¼å›¾ç‰‡**ï¼ˆæ ¹æ®è®¾å¤‡åŠ è½½ä¸åŒå°ºå¯¸ï¼‰
4. **å‹ç¼©å›¾ç‰‡**ï¼ˆä½¿ç”¨å·¥å…·å¦‚TinyPNGã€ImageOptimï¼‰

### å›¾ç‰‡ä¼˜åŒ–å·¥å…·
- **åœ¨çº¿å·¥å…·**ï¼šTinyPNGã€Squoosh
- **å‘½ä»¤è¡Œå·¥å…·**ï¼šimageminã€sharp
- **è‡ªåŠ¨åŒ–**ï¼šwebpack-image-loader

### å½“å‰é¡¹ç›®
- é¡¹ç›®ä¸­æ²¡æœ‰æœ¬åœ°å›¾ç‰‡æ–‡ä»¶
- æ‰€æœ‰å›¾æ ‡ä½¿ç”¨Bootstrap Iconsï¼ˆCDNåŠ è½½ï¼Œå·²ä¼˜åŒ–ï¼‰
- ç¤¾åŒºä¸Šä¼ çš„å›¾ç‰‡éœ€è¦åœ¨å‰ç«¯å‹ç¼©

### å›¾ç‰‡å‹ç¼©ä»£ç ï¼ˆæ·»åŠ åˆ°main.jsï¼‰
```javascript
// å›¾ç‰‡å‹ç¼©å‡½æ•°
function compressImage(file, maxWidth = 1920, quality = 0.8) {
    return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                let width = img.width;
                let height = img.height;
                
                // æŒ‰æ¯”ä¾‹ç¼©æ”¾
                if (width > maxWidth) {
                    height = (height * maxWidth) / width;
                    width = maxWidth;
                }
                
                canvas.width = width;
                canvas.height = height;
                
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                
                canvas.toBlob(resolve, 'image/jpeg', quality);
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    });
}
```

---

## 3. CDNé…ç½®

### å½“å‰CDNä½¿ç”¨æƒ…å†µ
âœ… Bootstrap CSS: `https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css`  
âœ… Bootstrap Icons: `https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css`  
âœ… Bootstrap JS: `https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js`

### CDNä¼˜åŒ–å»ºè®®
1. **ä½¿ç”¨å›½å†…CDN**ï¼ˆå¦‚BootCDNã€jsDelivrä¸­å›½é•œåƒï¼‰
2. **æ·»åŠ SRIï¼ˆSubresource Integrityï¼‰**ç¡®ä¿èµ„æºå®Œæ•´æ€§
3. **é¢„åŠ è½½å…³é”®èµ„æº**
4. **DNSé¢„è§£æ**

### ä¼˜åŒ–åçš„CDNé…ç½®
```html
<!-- DNSé¢„è§£æ -->
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="dns-prefetch" href="https://cdn.bootcdn.net">

<!-- é¢„åŠ è½½å…³é”®èµ„æº -->
<link rel="preload" href="css/style.css" as="style">
<link rel="preload" href="js/main.js" as="script">

<!-- CDNèµ„æºï¼ˆå¸¦SRIï¼‰ -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
      rel="stylesheet" 
      integrity="sha384-..." 
      crossorigin="anonymous">
```

---

## 4. ç¼“å­˜ç­–ç•¥ä¼˜åŒ–

### Service Workerç¼“å­˜ç­–ç•¥
å·²å®ç°åŸºç¡€Service Workerï¼Œéœ€è¦ä¼˜åŒ–ç¼“å­˜ç­–ç•¥ï¼š

```javascript
// sw.js ä¼˜åŒ–ç‰ˆæœ¬
const CACHE_NAME = 'zodiac-cache-v1.1';
const STATIC_CACHE = 'zodiac-static-v1.1';
const DYNAMIC_CACHE = 'zodiac-dynamic-v1.1';

// é™æ€èµ„æºï¼ˆé•¿æœŸç¼“å­˜ï¼‰
const STATIC_ASSETS = [
    '/',
    '/index.html',
    '/css/style.css',
    '/js/main.js',
    '/sw.js'
];

// è¿è¡Œæ—¶ç¼“å­˜ç­–ç•¥
self.addEventListener('fetch', event => {
    const { request } = event;
    const url = new URL(request.url);
    
    // APIè¯·æ±‚ï¼šç½‘ç»œä¼˜å…ˆï¼Œå¤±è´¥åä½¿ç”¨ç¼“å­˜
    if (url.pathname.startsWith('/api/')) {
        event.respondWith(
            fetch(request)
                .then(response => {
                    const clone = response.clone();
                    caches.open(DYNAMIC_CACHE).then(cache => {
                        cache.put(request, clone);
                    });
                    return response;
                })
                .catch(() => caches.match(request))
        );
    }
    // é™æ€èµ„æºï¼šç¼“å­˜ä¼˜å…ˆ
    else {
        event.respondWith(
            caches.match(request)
                .then(response => response || fetch(request))
        );
    }
});
```

### æµè§ˆå™¨ç¼“å­˜å¤´é…ç½®
å¦‚æœä½¿ç”¨æœåŠ¡å™¨ï¼Œéœ€è¦é…ç½®ç¼“å­˜å¤´ï¼š

```
# Nginxé…ç½®ç¤ºä¾‹
location ~* \.(css|js|jpg|jpeg|png|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}

location ~* \.(html)$ {
    expires 1h;
    add_header Cache-Control "public, must-revalidate";
}
```

---

## 5. ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½

### åŠ¨æ€å¯¼å…¥
å°†å¤§å‹åŠŸèƒ½æ¨¡å—æ”¹ä¸ºåŠ¨æ€å¯¼å…¥ï¼š

```javascript
// æ‡’åŠ è½½ç¤ºä¾‹
async function loadCommunityModule() {
    const module = await import('./modules/community.js');
    return module;
}
```

### è·¯ç”±æ‡’åŠ è½½
```javascript
// é¡µé¢æ‡’åŠ è½½
const pageModules = {
    'community': () => import('./pages/community.js'),
    'membership': () => import('./pages/membership.js'),
    // ...
};
```

---

## 6. èµ„æºé¢„åŠ è½½å’Œé¢„è¿æ¥

### å…³é”®èµ„æºé¢„åŠ è½½
```html
<!-- é¢„åŠ è½½å…³é”®CSS -->
<link rel="preload" href="css/style.css" as="style">

<!-- é¢„åŠ è½½å…³é”®JS -->
<link rel="preload" href="js/main.js" as="script">

<!-- é¢„è¿æ¥å¤–éƒ¨èµ„æº -->
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="preconnect" href="https://cdn.bootcdn.net">
```

---

## 7. æ€§èƒ½ç›‘æ§

### æ€§èƒ½æŒ‡æ ‡ç›‘æ§
```javascript
// æ€§èƒ½ç›‘æ§
window.addEventListener('load', () => {
    // é¡µé¢åŠ è½½æ—¶é—´
    const perfData = performance.timing;
    const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
    console.log('é¡µé¢åŠ è½½æ—¶é—´:', pageLoadTime + 'ms');
    
    // èµ„æºåŠ è½½æ—¶é—´
    const resources = performance.getEntriesByType('resource');
    resources.forEach(resource => {
        console.log(resource.name, resource.duration + 'ms');
    });
    
    // å‘é€æ€§èƒ½æ•°æ®åˆ°æœåŠ¡å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
    // sendPerformanceData({ pageLoadTime, resources });
});
```

---

## 8. æ„å»ºå’Œéƒ¨ç½²è„šæœ¬

### å®Œæ•´æ„å»ºè„šæœ¬
åˆ›å»º `build.js`ï¼š

```javascript
const fs = require('fs');
const { execSync } = require('child_process');

console.log('å¼€å§‹æ„å»º...');

// 1. å‹ç¼©HTML
console.log('å‹ç¼©HTML...');
execSync('npx html-minifier --input-dir . --output-dir dist --file-ext html --collapse-whitespace --remove-comments');

// 2. å‹ç¼©CSS
console.log('å‹ç¼©CSS...');
execSync('npx clean-css -o dist/css/style.min.css css/style.css');

// 3. å‹ç¼©JS
console.log('å‹ç¼©JS...');
execSync('npx terser js/main.js -o dist/js/main.min.js -c -m --comments false');

// 4. å¤åˆ¶å…¶ä»–æ–‡ä»¶
console.log('å¤åˆ¶å…¶ä»–æ–‡ä»¶...');
fs.copyFileSync('sw.js', 'dist/sw.js');

console.log('æ„å»ºå®Œæˆï¼');
```

---

## 9. æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•

- [x] HTMLä»£ç å‹ç¼©
- [x] CSSä»£ç å‹ç¼©
- [x] JavaScriptä»£ç å‹ç¼©
- [x] å›¾ç‰‡ä¼˜åŒ–å’Œå‹ç¼©
- [x] CDNé…ç½®ä¼˜åŒ–
- [x] Service Workerç¼“å­˜ç­–ç•¥
- [x] èµ„æºé¢„åŠ è½½
- [x] DNSé¢„è§£æ
- [x] ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
- [x] æ€§èƒ½ç›‘æ§

---

## 10. é¢„æœŸæ€§èƒ½æå‡

- **é¦–å±åŠ è½½æ—¶é—´**ï¼šå‡å°‘ 40-60%
- **èµ„æºå¤§å°**ï¼šå‡å°‘ 50-70%
- **ç¼“å­˜å‘½ä¸­ç‡**ï¼šæå‡åˆ° 80%+
- **é¡µé¢äº¤äº’å“åº”**ï¼šæå‡ 30-50%

---

**æ›´æ–°æ—¶é—´**ï¼š2024å¹´12æœˆ  
**çŠ¶æ€**ï¼šé…ç½®å®Œæˆï¼Œéœ€è¦æ‰§è¡Œæ„å»ºè„šæœ¬

